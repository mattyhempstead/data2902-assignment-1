---
title: "DATA2902 Report"
author: "Matty Hempstead 490424010"
subtitle: "Analysis of Class Survey"
date: "23/09/2020"
output: 
  html_document:
      code_folding: hide
      df_print: paged
      fig_caption: yes
      number_sections: yes
      self_contained: yes
      toc: yes
      toc_float: yes
---

```{r setup, include=FALSE}
library(tidyverse)
library(readr)
library(skimr)
library(visdat)
library(dplyr)
library(gt)
```

# Introduction
A class survey was performed among DATA2X02 students through Google Forms, asking a variety of questions from shoe-size to steak_preference. In this report, we begin by discussing the effectiveness of the survey in terms of potential biases, and ways in which questions could be improved. We then perform three statistical tests to find potential correlations and relationships that may exist within the data.

The data was provided in CSV form and then cleaned to reduce the impact of possible biases and false/missing data.

```{r, output=F}
df = readr::read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vTf8eDSN_2QbMTyVvO5bdYKZSEEF2bufDdYnLnL-TsR8LM-6x-xu1cxmDMohlbLrkMJn9DE7EG7pg5P/pub?gid=1724783278&single=true&output=csv", col_types=cols())

# Rename all columns
colnames(df) = c("timestamp", "covid_tests", "gender", "postcode", "dentist", "university_hours", "social_media", "dog_or_cat", "live_with_parents", "exercise_hours", "eye_colour", "asthma", "employment_hours", "favourite_season", "shoe_size", "height", "floss", "glasses_or_contacts", "dominant_hand", "steak_preference", "stress_rating")

# skimr::skim(data)
# visdat::vis_miss(data)
```


## Potential Biases

```{r, results="hide"}
dim(df)[1]
```

[//]: **What are the potential biases? Which variables are most likely to be subjected to this bias?**

While the survey was offered to all $572$ students, only $174$ responses were recorded. As a result, the data should *not* be interpreted as reflecting a *random sample of DATA2X02 students*, rather the samples consist only of students who were aware of, and willing to complete the survey. This itself is a potential form of selection bias, as individuals who responded may be the type of students who are more willing to participate and engage in university activities. As a result, this could skew variables such as the number of study hours or stress ratings, as these students may be more likely to spend extra time on university work, and this may correlate with higher (or lower) stress levels.

A large number of questions that are not easily objectively determined could be susceptible to recall or estimation bias. The three questions related to the number of weekly hours spent doing an activity last semester (university, employment, exercising) are likely quite poor estimations given the specificity of the answer. The time since the last dentist appt. may be similarly biased, especially when a student needs to differentiate between a small event that occurred say 11, or 13 months ago. Other questions which may be biased by estimation or recall bias include COVID tests, height (for those guessing), stress level and flossing frequency.

```{r}
hour_responses = c(unlist(df[,"university_hours"]), unlist(df[,"employment_hours"]), unlist(df[,"exercise_hours"]))
hour_responses = hour_responses[hour_responses > 0]
round_responses = hour_responses[hour_responses %% 5 != 0]
round_responses_percent = 100*length(round_responses)/length(hour_responses)
```
The questions asking for a number of hours are likely suceptible to *round number bias*, where people are more likely to respond with *nice* numbers, like those that end in $5$'s or $0$'s. In the given survey, out of the `r length(hour_responses)` responses to hour-based questions that were greater than $0$, ~$`r round(round_responses_percent)`$% ended with a $5$ or $0$, clearly demonstrating this bias (we expect something closer to $20$%).

In some questions people may deliberately give false data due to social stigmas. For example, respondants (particularly males) may have described themselves as taller. Also, some might have incentive to lie about the frequency of teeth flossing, or the number of study hours, as society generally perceives these as positive attributes.

Some questions are subjective (stress, study hours, etc).  
Questions that were more likely to be missing data due to privacy concerns (e.g. )  
Likely that some people didn't answer / answers more than once, or did not take survey seriously. Is this a bias?  
There are also a number of outliers.  


## Potential Improvements

**Are there any questions that needed improvement to generate useful data?**
Does useful data include clean data?

Many questions should specify units. Shoe size (AU/UK), height.
Plot a hist of shoe size to indicate this issue, there should be ~3 general peaks.


Other, more subjective questions could made more objective.
Stress level should mention that 0=not stressed at all and 10=constant high level of stress.
Reason being is some people may interpret values like 10 as referring to a constant high level of stress, where as other may see 10 as being the most stressed they have ever been. 

Hours exercising/studying should be made more specific, similar to the paid employment question, which generally has an objective understanding. 
Should define what is meant by excercise (going for a walk? swim at the beach? jogging/running?).
Also define what is meant by uni work. Does this include watching lectures/attending tuts?


# Data Cleaning

Data cleaning was performed adapting the code of Tarr (2020)...

To address issues described above I have done some cleaning.


While most variables required cleaning, only the data which is analysed undergoes pre-processing, as it could affect future statistical conclusions.


```{r}
# make sure u quote this or something

#data = data %>% 
#  dplyr::mutate(
#    height = dplyr::case_when(
#      height < 2.3 ~ height*100,
#      TRUE ~ height
#    ),
#    
#    gender = toupper(gender),
#    gender = stringr::str_sub(gender, start=1, end=1)
#    
#    gender = gendercodeR::recode_gender(gender)
#  )

# Drop rows with missing values for all entries except timestamp
df = df[apply(!is.na(df[,2:21]), 1, any),]


#df = df[df["eye_colour"] != "orange" & df["eye_colour"] != "Yellow",]

df = df %>% 
#  dplyr::filter(
#    # Remove orange/yellow eye colour entries as they are likely non-serious
#    eye_colour != "orange" & eye_colour != "Yellow"
#  ) %>%
  dplyr::mutate(
    # Standardize gender into male,female,non-binary
    gender = toupper(gender),
    gender = dplyr::case_when(
      startsWith(gender, "M") ~ "male",
      startsWith(gender, "F") ~ "female",
      TRUE ~ "non-binary"
    ),
    
    asthma = dplyr::case_when(
      asthma == "Yes" ~ TRUE,
      TRUE ~ FALSE
    ),
    
    dog_or_cat = dplyr::case_when(
      dog_or_cat == "Yes" ~ TRUE,
      TRUE ~ FALSE
    )
  )

```

Do some more cleaning...



# Are COVID-19 tests randomly performed?

## Hypothesis
Based on the provided COVID-19 test data, we investigate whether tests are performed at random times with equal likelihood across all students. 
If this was the case, we would expect that the number of tests follows a Poisson distribution, which measures the number of events that occur in a fixed interval of time. The Poisson distribution also assumes that the events occur at the same rate throughout the interval, and are independant from one-another.

$H_0$: the number of covid cases for each person follows a Poisson distribution.  
$H_1$: the data does not follow a Poisson distribution.

[//]: Out of 174 responses, 172 have a response for the number of times a person has been tested for covid.
[//]: Assume each person is equally likely to receive a test at any given time.
[//]: Since the sum of poissons is also poisson, the probability of a test in a set time period may change over time, as long as it remains constant for all people?
[//]: Each person can be seen as an independant trial.


```{r}
covid_tests = dplyr::pull(df,"covid_tests")

knitr::kable(t(table(factor(covid_tests, levels=0:10))))
```

## Assumptions


We can safely assume the observations are independant, as one student receiving a covid test should not affect the probability of another student receiving a test. Perhaps if the students lived together then tests may be correlated, however this is likely not the case for the vast majority of students.


```{r, output=F}
y = unname(table(factor(covid_tests, levels=0:10)))
lambda_est = mean(covid_tests)

# get expected probabilities, ensure they sum to 1
p = dpois(0:10, lambda=lambda_est)
p[11] = 1 - sum(p[0:10])
ey = length(covid_tests) * p

# combine tail to ensure ey >= 5
yr = c(y[1:2], sum(y[3:11]))
pr = c(p[1:2], sum(p[3:11]))
eyr = c(ey[1:2], sum(ey[3:11]))
```


```{r}
xr = c("0","1",">=2") # group labels
par(mfrow=c(1,2), cex = 1.5) # plot options
barplot(yr,names.arg=xr,
        main="Observed frequency")
barplot(eyr,names.arg=xr,
        main="Expected frequency")
```

To ensure the assumption that expected frequencies are $\geq 5$, we group together all observations where $x >= 2$.

## Test
We perform a chi-squared test with 1 degree of freedom.
Why?

Talk about why we performed this instead of another test.


$$t_0 = \sum_{i=1}^k \frac{(Y_i-n p_i)^2}{n p_i}$$

Under $H_0$, $T \sim \chi_1^2$ approximately.

```{r}
kr = length(yr)
t0 = sum((yr - eyr)^2/eyr)
pval = 1 - pchisq(t0, df = kr - 1 - 1)
```

The final test statistic is ~$`r signif(t0, 5)`$ with a p-value of ~$`r signif(pval, 3)`$.

## Results
As $p \leq 0.001$, we reject $H_0$ and accept $H_1$ that covid test cases do not follow a Poisson distribution.

This result can likely be explained with various reasons. For one, it is likely that each student is exposed to covid testing at different rates, with individuals in high-risk areas such as inner-sydney being tested far more often than students in low-risk areas. Furthermore, the memoryless property of a Poisson distribution may not apply, as students who are tested once might have been exposed to the virus or be near others who have been, potentially increasing the chances of future tests.

Maybe a quick plot of the number of postcode?
Considering the plot in the assumptions, it might support that memoryless is not obeyed.



# Does having a dog or cat increase the risk of asthma?

## Hypothesis
Pet hair, like that from dogs or cats, is known to be a catalyst of asthma attacks. 
However, does pet hair simply stimulate asthma attacks among those already with the condition, or is there an underlying correlation between people who report having asthma, and people who have owned dogs or cats.


Need to flip yes and nos.

```{r}
sample = drop_na(df, c("dog_or_cat", "asthma"))
tbl = table(t(sample["dog_or_cat"]), t(sample["asthma"]), dnn=c("dog_or_cat", "asthma"))
tbl = tbl[2:1, 2:1] # flip table to get TRUE,TRUE in top left

knitr::kable(tbl)
```


$H_0$: The odds ratio $\theta$ of having a dog/cat and having asthma is $1$.  
$H_1$: The odds ratio $\theta > 1$, meaning those who have owned dogs/cats are more likely to report having asthma.  

Not necessarily a causation.
Potentially those with cats/dogs were more aware of their asthma as they were more often exposed to asthma-inducing situtions such as pet hair.

```{r}
odds_ratio = (tbl[1]*tbl[4]) / (tbl[2]*tbl[3])
```
The contingency table of the observed data has an odds ratio of ~$`r round(odds_ratio,2)`$.

## Assumption
As we are performing an exact test, we only need to make the assumption that the samples are independent from one-another. This can be assumed given that the presence/absence of a dog/cat or asthma should not affect its presense/absence in another student.

## Test
To perform a one-sided Fisher's Exact Test, we find the probability of a contingency table using the same marginal totals, with at least as extreme an odds ratio. 
To do this we find the total number of more extreme tables, and divide by the total number of tables (under the same marginal totals).

```{r, results="hide"}
# Find the number of possible permuations at least as extreme


fisher.test(tbl, alternative="greater")
```
The test reveals a $95$% confidence interval for the odds ratio of $[0.939, \infty]$.
We get a p-value of ~$0.067$.


## Results
Our $95$% confidence interval contains the value $1$, and so our p-value $>=0.05$.  
We therefore accept the null hypothesis $H_0$ that the odds ratio is $1$, and reject the alternative hypothesis $H_1$.




# Who studies more, males or females?

## Hypothesis
Data science has a large overrepresentation of males, but who studies more?

Note that we limit this study to cisgendered people, as there are only 3 non-binary responses, which is not enough data to produce any statistically signficant results.

```{r}
# ignore categories with NA for gender or study hours
sample = drop_na(df, c("gender", "university_hours"))
male_hours = sample["university_hours"][sample["gender"] == "male"]
female_hours = sample["university_hours"][sample["gender"] == "female"]
```


$H_0$: the mean weekly study hours is the same among men and women.  
$H_1$: the mean weekly study hours is differs among men and women.

Do a side-by-side box plot.

```{r}

bplot = boxplot(male_hours, female_hours, names=c("Male", "Female"), horizontal = T)

#  remove outliers
outliers = unlist(bplot["out"])
male_hours = male_hours[!male_hours %in% outliers]
female_hours = female_hours[!female_hours %in% outliers]

# remove zero values
male_hours = male_hours[male_hours > 0]
female_hours = female_hours[female_hours > 0]
```
We ignore outlier values, in particular the values $98$ and $170$ for males, and $84$ for females.
The value $170$ is most likely not a serious answer. While $98$ and $84$ may be possible, they would represent extreme students which can be ignored as they do not represent a typical sample from the population.

Can also justify ignoring values equal to 0, since this most likely suggests the students were not enrolled in university, which is not what I am testing.


Males have a mean study hour of $`r mean(male_hours)`$ and SD $`r sqrt(var(male_hours))`$.  
Females have a mean study hour of $`r mean(female_hours)`$ and SD $`r sqrt(var(female_hours))`$.  


## Assumptions

We make the assumption that all samples (male or female), are independent from one another as the study hours of one student should not influence the study hours of another. There is the possibility that some students may be friends, and their study hours may be correlated due through group studying, however we assume this effect is negligible.

[//]: However, this may not have been the case if students were allowed to see the responses of past students, as this could influence the responses of students wanting to seem average.


We also need to make the assumption that study hours for both males and females follow a normal distribution.  
In particular, male responses $X_1,X_2,...,X_{n_x}$ should be iid $N(\mu_X, \sigma^2_X)$.  
Similarly, female responses $Y_1,Y_2,...,Y_{n_y}$ are assumed to be iid $N(\mu_Y, \sigma^2_Y)$.

```{r}
qqnorm(male_hours)
qqline(male_hours)

qqnorm(female_hours)
qqline(female_hours)
```

According to the QQ-plots for male and female study hours, the study values seem approximately normal.

## Test
Given the assumption of iid samples from normal distributions with different variances, we perform a Welch Two-Sample t-test. If instead the samples had equal variance, a standard Two-Sample t-test would have been appropriate.

The test statistic is 

$$t_0 = \frac{\bar X-\bar Y}{\sqrt{\frac{S_X^2}{n_x}+\frac{S_Y^2}{n_y}}}$$
```{r, results="hide"}
t.test(male_hours, female_hours, alternative="two.sided")
```
The final test statistic is $-2.94$ with a p-value of ~$0.004$.

## Results
As $p \leq 0.01$, we reject $H_0$ and accept the alternative hypothesis $H_1$ that the mean study hours differ among men and women.

Explain why.
Reference some studies about study differences.
Also maybe talk about how men are more likely to exaggerate?
Cite.




# Conclusion

conclusion should discuss the results and limitations of your work, it might also highlight future research directions (what would you like to have done but weren't able to).



# References

Tarr, G (2020). DATA2002 Data Analytics: Learning from Data. University of Sydney, Sydney Australia.







